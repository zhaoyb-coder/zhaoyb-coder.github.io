(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{506:function(s,t,a){"use strict";a.r(t);var n=a(30),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"mysql日志详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql日志详解"}},[s._v("#")]),s._v(" Mysql日志详解")]),s._v(" "),a("h2",{attrs:{id:"_1、binlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、binlog"}},[s._v("#")]),s._v(" 1、Binlog")]),s._v(" "),a("p",[a("code",[s._v("Binlog属于Mysql server层的维护的一种二进制日志")]),s._v("，主要记录对于对Mysql数据更新的SQL语句，以“event”的形式保存在磁盘中")]),s._v(" "),a("p",[a("code",[s._v("Binlog的写入时机是SQL transaction 执行完，但是任何相关的Locks还没释放或者事务还没最终commit前")]),s._v("，这样就保证了Binlog记录的操作时序与数据库实际的数据变更顺序一致")]),s._v(" "),a("h3",{attrs:{id:"_1-1、binlog的主要作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1、binlog的主要作用"}},[s._v("#")]),s._v(" 1.1、Binlog的主要作用")]),s._v(" "),a("ul",[a("li",[s._v("数据恢复：通过mysqlbinlog工具恢复数据")]),s._v(" "),a("li",[s._v("主从复制：MySQL在Master端开启binlog，Master把它的二进制日志传递给slaves并回放(中继日志)来达到master-slave数据一致的目的\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20231211163625304.png",alt:"image-20231211163625304"}})])]),s._v(" "),a("h3",{attrs:{id:"_1-2、binlog文件类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、binlog文件类型"}},[s._v("#")]),s._v(" 1.2、Binlog文件类型")]),s._v(" "),a("ul",[a("li",[s._v("二进制日志索引文件(.index)：记录所有的二进制文件\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20231211153708238.png",alt:"image-20231211153708238"}})]),s._v(" "),a("li",[s._v("二进制日志文件(.00000*)：记录所有 DDL 和 DML 语句事件\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20231211153741608.png",alt:"image-20231211153741608"}})])]),s._v(" "),a("h3",{attrs:{id:"_1-3、相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3、相关命令"}},[s._v("#")]),s._v(" 1.3、相关命令")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 检查 Binlog 文件是否已开启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%log_bin%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看binlog列表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("binary")]),s._v(" logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看最新的binlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看 Binlog 日志")]),s._v("\nmysqlbinlog mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" more\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看当前 Binlog 文件对应的详细事件信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" binlog events "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.00000*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询当前 Binlog 日志使用格式 Statement|Row|Mixed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%binlog_format%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--mysqlbinlog 命令手动恢复数据 ")]),s._v("\nmysqlbinlog "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--start-position=0  --stop-position=500  mysql-bin.00000* > /root/back.sql;")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h3",{attrs:{id:"_1-4、相关参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4、相关参数"}},[s._v("#")]),s._v(" 1.4、相关参数")]),s._v(" "),a("p",[s._v("my.cnf文件中对于binlog的配置参数：")]),s._v(" "),a("ul",[a("li",[s._v("log-bin=/home/mysql/binlog/  设置此参数表示启用binlog功能，并制定二进制日志的存储目录")]),s._v(" "),a("li",[s._v("max_binlog_size=104857600  日志文件最大字节（单位：字节） Binlog 最大和默认值是 1G")]),s._v(" "),a("li",[s._v("expire_logs_days = 7  设置了只保留7天BINLOG（单位：天）")]),s._v(" "),a("li",[s._v("binlog-do-db=db_name  binlog日志只记录指定库的更新")]),s._v(" "),a("li",[s._v("binlog-ignore-db=db_name  binlog日志不记录指定库的更新")]),s._v(" "),a("li",[s._v("sync_binlog=0  写缓冲多少次，刷一次磁盘，默认0")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("Binlog的过期删除不是服务定时执行，而是由事件触发的，能够触发的事件包括")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("服务器重启")])]),s._v(" "),a("li",[a("p",[s._v("服务器被更新")])]),s._v(" "),a("li",[a("p",[s._v("日志达到了最大长度")])]),s._v(" "),a("li",[a("p",[s._v("日志被刷新")])])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("Binlog的刷新频率：sync_binlog默认为0 ，代表由操作系统根据自身负载自行决定多久写一次磁盘，如果修改为1或者n，那么代表执行每1次或者n次事务提交时会立刻写入磁盘")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_1-5、日志格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5、日志格式"}},[s._v("#")]),s._v(" 1.5、日志格式")]),s._v(" "),a("p",[s._v("Binlog提供了三种模式来记录日志：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Statement 模式：基于 SQL 语句的复制(statement-based replication-SBR)\n优点：不需要记录每一行的变化，减少了binlog日志量，节约了IO，提高性能")]),s._v(" "),a("p",[s._v("缺点：特定函数功能不能进行复制，如sleep()、UUID()")])]),s._v(" "),a("li",[a("p",[s._v("Row 模式：基于行的复制(row-based replication-RBR)\n优点：非常清楚的记录下每一行数据修改的细节\n缺点：所有的执行的语句当记录到日志中的时候，都将以每行记录的修改来记录，这样可能会产生大量的日志内容")])]),s._v(" "),a("li",[a("p",[s._v("Mixed 模式：混合模式复制(mixed-based replication-MBR)\n是以上两种level的混合使用，一般的语句修改使用statment格式保存binlog，如一些函数，statement无法完成主从复制的操作，则采用row格式保存binlog,MySQL会根据执行的每一条具体的sql语句来区分对待记录的日志形式")])])]),s._v(" "),a("h2",{attrs:{id:"_2、redo-log"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、redo-log"}},[s._v("#")]),s._v(" 2、redo log")]),s._v(" "),a("p",[a("code",[s._v("redo log属于Mysql Innodb引擎层维护的日志数据")]),s._v("，记录的数据是事务执行过程中的执行情况，主要"),a("code",[s._v("用来保证事务的持久性")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20231211162212610.png",alt:"image-20231211162212610"}})]),s._v(" "),a("h2",{attrs:{id:"_3、undo-log"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、undo-log"}},[s._v("#")]),s._v(" 3、undo log")]),s._v(" "),a("h2",{attrs:{id:"_4、慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、慢查询日志"}},[s._v("#")]),s._v(" 4、慢查询日志")])])}),[],!1,null,null,null);t.default=e.exports}}]);