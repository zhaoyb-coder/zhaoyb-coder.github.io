(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{511:function(s,a,t){"use strict";t.r(a);var n=t(30),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis-概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-概述"}},[s._v("#")]),s._v(" Redis-概述")]),s._v(" "),t("h3",{attrs:{id:"_1、数据结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、数据结构"}},[s._v("#")]),s._v(" 1、数据结构")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20240103162410843.png",alt:"image-20240103162410843"}})]),s._v(" "),t("h4",{attrs:{id:"_1-1、string"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1、string"}},[s._v("#")]),s._v(" 1.1、String")]),s._v(" "),t("blockquote",[t("p",[s._v("字符串对象的编码可以是int、raw或者embstr")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如果保存的是整数，并且整数可以被long表示，那么底层存储的字符串编码就是int")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置num值为100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" num "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看num编码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING num\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"int"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("如果保存的是字符串，小于等于32字节，那么字符串对象编码使用embstr来保存")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" msg "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING msg\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embstr"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("如果保存的是字符串，大于32字节，那么字符串使用简单动态字符串（SDS）来保存，编码设置为raw")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" bigmsg "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"long long ago......."')]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询字符串大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" STRLEN bigmsg\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING bigmsg\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"raw"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"_1-2、list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、list"}},[s._v("#")]),s._v(" 1.2、List")]),s._v(" "),t("blockquote",[t("p",[s._v("列表对象的编码可以是ziplist或者linkedlist")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("列表对象保存的所有字符串元素的长度都小于64字节 并且 列表对象保存的元素数量小于512个，使用ziplist编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有元素的长度都小于64字节")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" RPUSH blah "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"world"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"again"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING blah\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ziplist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将一个65字节长的元素推入列表对象中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" RPUSH blah "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编码已改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING blah\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linkedlist"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("否则 使用linkedlist编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列表对象包含512个元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EVAL "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"for i=1, 512 do redis.call('RPUSH', KEYS[1],i)end\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"integers"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" LLEN integers\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING integers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ziplist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再向列表对象推入一个新元素，使得对象保存的元素数量达到513个")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" RPUSH integers "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("513")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("513")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编码已改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING integers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linkedlist"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"_1-3、hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3、hash"}},[s._v("#")]),s._v(" 1.3、Hash")]),s._v(" "),t("blockquote",[t("p",[s._v("哈希对象的编码可以是ziplist或者hashtable")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("哈希对象保存的所有键值对的键和值的字符串长度都小于64字节 并且 哈希对象保存的键值对数量小于512个，哈希对象使用ziplist编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 哈希对象只包含一个键和值都不超过64个字节的键值对")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HSET book name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mastering C++ in 21 days"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING book\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ziplist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 向哈希对象添加一个新的键值对，键的长度为66字节")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HSET book long_long_long_long_long_long_long_long_long_long_long_description "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"content"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编码已改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING book\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hashtable"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("否则 使用hashtable编码")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个包含512个键值对的哈希对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EVAL "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"for i=1, 512 do redis.call('HSET', KEYS[1], i, i)end\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"numbers"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HLEN numbers\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING numbers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ziplist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再向哈希对象添加一个新的键值对，使得键值对的数量变成513个")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HMSET numbers "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HLEN numbers\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("513")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编码改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING numbers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hashtable"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h4",{attrs:{id:"_1-4、set"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4、set"}},[s._v("#")]),s._v(" 1.4、Set")]),s._v(" "),t("blockquote",[t("p",[s._v("集合对象的编码可以是intset或者hashtable")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("集合对象保存的所有元素都是整数值 并且 集合对象保存的元素数量不超过512个，使用intset编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SADD numbers "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING numbers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"intset"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("否则使用hashtable编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SADD numbers "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"seven"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING numbers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hashtable"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"_1-5、zset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5、zset"}},[s._v("#")]),s._v(" 1.5、ZSet")]),s._v(" "),t("blockquote",[t("p",[s._v("有序集合的编码可以是ziplist或者skiplist")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("有序集合保存的元素数量小于128个 并且 有序集合保存的所有元素成员的长度都小于64字节，使用ziplist编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对象包含了128个元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EVAL "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"for i=1, 128 do redis.call('ZADD', KEYS[1], i, i) end\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" numbers\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ZCARD numbers\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING numbers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ziplist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再添加一个新元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ZADD numbers "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.14")]),s._v(" pi\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对象包含的元素数量变为129个")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ZCARD numbers\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("129")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编码已改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING numbers\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"skiplist"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("否则使用skiplist编码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 向有序集合添加一个成员只有三字节长的元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ZADD blah "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" www\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING blah\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ziplist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 向有序集合添加一个成员为66字节长的元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ZADD blah "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编码已改变")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OBJECT ENCODING blah\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"skiplist"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_2、过期键删除策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、过期键删除策略"}},[s._v("#")]),s._v(" 2、过期键删除策略")]),s._v(" "),t("p",[s._v("如果一个键过期了，那么它什么时候会被删除呢？")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("定时删除")]),s._v("：在设置键的过期时间的同时，创建一个定时器（timer），让定时器在键的过期时间来临时，立即执行对键的删除操作\n内存友好，CPU不友好，在过期键比较多的情况下，删除过期键这一行为可能会占用相当一部分CPU时间，在内存不紧张但是CPU时间非常紧张的情况下，将CPU时间用在删除和当前任务无关的过期键上，无疑会对服务器的响应时间和吞吐量造成影响")]),s._v(" "),t("li",[t("strong",[s._v("惰性删除")]),s._v("：放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键；如果没有过期，就返回该键\n内存不友好，CPU友好，如果一个键已经过期，而这个键又仍然保留在数据库中，那么只要这个过期键不被删除，它所占用的内存就不会释放，可以理解为一种内存泄漏")]),s._v(" "),t("li",[t("strong",[s._v("定期删除")]),s._v("：每隔一段时间，程序就对数据库进行一次检查，删除里面的过期键。至于要删除多少过期键，以及要检查多少个数据库，则由算法决定；定期删除策略是前两种策略的一种整合和折中\n"),t("ul",[t("li",[s._v("定期删除策略每隔一段时间执行一次删除过期键操作，并通过限制删除操作执行的时长和频率来减少删除操作对CPU时间的影响")]),s._v(" "),t("li",[s._v("通过定期删除过期键，定期删除策略有效地减少了因为过期键而带来的内存浪费")])])])]),s._v(" "),t("p",[s._v("Redis使用的是惰性删除和定期删除两种策略：通过配合使用这两种删除策略，服务器可以很好地在合理使用CPU时间和避免浪费内存空间之间取得平衡。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20240104160325217.png",alt:"image-20240104160325217"}})]),s._v(" "),t("p",[s._v("过期键的定期删除策略由redis.c/activeExpireCycle函数实现：")]),s._v(" "),t("ul",[t("li",[s._v("函数每次运行时，都从一定数量的数据库中取出一定数量的随机键进行检查，并删除其中的过期键")]),s._v(" "),t("li",[s._v("全局变量current_db会记录当前activeExpireCycle函数检查的进度，并在下一次activeExpireCycle函数调用时，接着上一次的进度进行处理。比如说，如果当前activeExpireCycle函数在遍历10号数据库时返回了，那么下次activeExpireCycle函数执行时，将从11号数据库开始查找并删除过期键")]),s._v(" "),t("li",[s._v("随着activeExpireCycle函数的不断执行，服务器中的所有数据库都会被检查一遍，这时函数将current_db变量重置为0，然后再次开始新一轮的检查工作")])]),s._v(" "),t("h3",{attrs:{id:"_3、aof、rdb对于过期键的影响"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、aof、rdb对于过期键的影响"}},[s._v("#")]),s._v(" 3、AOF、RDB对于过期键的影响")]),s._v(" "),t("h4",{attrs:{id:"_3-1、rdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、rdb"}},[s._v("#")]),s._v(" 3.1、RDB")]),s._v(" "),t("p",[s._v("生成RDB文件对于过期键的影响：")]),s._v(" "),t("p",[s._v("在执行SAVE命令或者BGSAVE命令创建一个新的RDB文件时，程序会对数据库中的键进行检查，已过期的键不会被保存到新创建的RDB文件中")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("载入RDB文件对于过期键的影响：")]),s._v(" "),t("ul",[t("li",[s._v("如果是主服务器：在载入RDB文件时，程序会对文件中保存的键进行检查，未过期的键会被载入到数据库中，而过期键则会被忽略。")]),s._v(" "),t("li",[s._v("如果是从服务器：在载入RDB文件时，文件中保存的所有键，不论是否过期，都会被载入到数据库中。不过，因为主从服务器在进行数据同步的时候，从服务器的数据库就会被清空。")])]),s._v(" "),t("h4",{attrs:{id:"_3-2、aof"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、aof"}},[s._v("#")]),s._v(" 3.2、AOF")]),s._v(" "),t("p",[s._v("当服务器以AOF持久化模式运行时，如果数据库中的某个键已经过期，但它还没有被惰性删除或者定期删除，那么AOF文件不会因为这个过期键而产生任何影响")]),s._v(" "),t("p",[s._v("当过期键被惰性删除或者定期删除之后，程序会向AOF文件追加（append）一条DEL命令，来显式地记录该键已被删除")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("AOF重写过程：")]),s._v(" "),t("p",[s._v("在执行AOF重写的过程中，程序会对数据库中的键进行检查，已过期的键不会被保存到重写后的AOF文件中")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("集群复制：")]),s._v(" "),t("ul",[t("li",[s._v("主服务器在删除一个过期键之后，会显式地向所有从服务器发送一个DEL命令，告知从服务器删除这个过期键")]),s._v(" "),t("li",[s._v("从服务器在执行客户端发送的读命令时，即使碰到过期键也不会将过期键删除，而是继续像处理未过期的键一样来处理过期键（"),t("code",[s._v("从服务器对于过期键也会返回给客户端")]),s._v("）")]),s._v(" "),t("li",[s._v("从服务器只有在接到主服务器发来的DEL命令之后，才会删除过期键")])]),s._v(" "),t("h3",{attrs:{id:"_4、redis持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、redis持久化"}},[s._v("#")]),s._v(" 4、Redis持久化")]),s._v(" "),t("h4",{attrs:{id:"_4-1、rdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、rdb"}},[s._v("#")]),s._v(" 4.1、RDB")]),s._v(" "),t("p",[s._v("RDB文件的生成：")]),s._v(" "),t("p",[s._v("有两个Redis命令可以用于生成RDB文件，一个是SAVE，另一个是BGSAVE")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("SAVE命令会阻塞Redis服务器进程，直到RDB文件创建完毕为止")])]),s._v(" "),t("li",[t("p",[s._v("BGSAVE命令会派生出一个子进程，然后由子进程负责创建RDB文件，服务器进程（父进程）继续处理命令请求")])])]),s._v(" "),t("p",[s._v("自动BGSAVE:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("save "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsave "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nsave "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("hr"),s._v(" "),t("p",[s._v("RDB文件的载入：")]),s._v(" "),t("p",[s._v("RDB文件的载入工作是在服务器启动时自动执行的，只要Redis服务器在启动时检测到RDB文件存在，它就会自动载入RDB文件。（因为AOF文件的更新频率通常比RDB更频繁，所以如果服务器同时开启了AOF持久化，那么服务器会优先使用AOF文件来还原数据库状态）")]),s._v(" "),t("p",[s._v("服务器在载入RDB文件期间，会一直处于阻塞状态，直到载入工作完成为止")]),s._v(" "),t("h4",{attrs:{id:"_4-2、aof"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、aof"}},[s._v("#")]),s._v(" 4.2、AOF")])])}),[],!1,null,null,null);a.default=e.exports}}]);