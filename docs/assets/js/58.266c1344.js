(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{371:function(a,s,t){"use strict";t.r(s);var e=t(8),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker安装elk8-x-踩坑记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装elk8-x-踩坑记录"}},[a._v("#")]),a._v(" Docker安装ELK8.x（踩坑记录）")]),a._v(" "),s("p",[a._v("参考网站：https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-prod-prerequisites")]),a._v(" "),s("p",[a._v("参考书籍：https://weread.qq.com/book-detail?type=1&senderVid=364791933&v=2a532390813ab8882g016839&wtheme=white&wfrom=app&wvid=364791933&scene=bottomSheetShare")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106105936476.png",alt:"image-20241106105936476"}})]),a._v(" "),s("h3",{attrs:{id:"_1、前置条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、前置条件"}},[a._v("#")]),a._v(" 1、前置条件")]),a._v(" "),s("h4",{attrs:{id:"_1-1、安装docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1、安装docker"}},[a._v("#")]),a._v(" 1.1、安装Docker")]),a._v(" "),s("p",[a._v("不在本篇文章探讨范围内")]),a._v(" "),s("h4",{attrs:{id:"_1-2、修改文件描述符数目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、修改文件描述符数目"}},[a._v("#")]),a._v(" 1.2、修改文件描述符数目")]),a._v(" "),s("blockquote",[s("p",[a._v("为什么要修改该配置呢？")]),a._v(" "),s("p",[a._v("首先，Elasticsearch在节点和HTTP客户端之间进行通信使用了大量的套接字，而套接字需要足够的文件描述符支持。")]),a._v(" "),s("p",[a._v("其次，在许多Linux发行版本中，每个进程默认有1024个文件描述符，这对Elasticsearch节点来说实在是太低了，何况该节点要处理数以百计的索引，所以要调大这个默认值")])]),a._v(" "),s("p",[a._v("设置步骤如下：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设定同时打开文件数的最大值为65535")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/profile\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 增加一行")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("ulimit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("65535")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使命令生效")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /etc/profile\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/security/limits.conf\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 限制打开文件数为65535")]),a._v("\n* soft nofile "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("65535")]),a._v("\n* hard nofile "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("65535")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 验证修改操作是否成功")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("ulimit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("h4",{attrs:{id:"_1-3、修改最大映射数量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3、修改最大映射数量"}},[a._v("#")]),a._v(" 1.3、修改最大映射数量")]),a._v(" "),s("blockquote",[s("p",[a._v("Elasticsearch对各种文件混合使用了niofs（非阻塞文件系统）和mmapfs（内存映射文件系统），以实现对各种文件的优化处理。为了保证系统的顺畅运行，需要合理配置最大映射数量(MMP)，以便有足够的虚拟内存可用于内存映射的文件")])]),a._v(" "),s("p",[a._v("设置步骤如下：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/sysctl.conf\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("vm.max_map_count")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("262144")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重新生效")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"_2、安装es-8-15-3-单机部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装es-8-15-3-单机部署"}},[a._v("#")]),a._v(" 2、安装es:8.15.3（单机部署）")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载elasticsearch镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull docker.elastic.co/elasticsearch/elasticsearch:8.15.3\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建网络，方便后续es和kibana两个容器通信，默认网络驱动为brige")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" network create elastic\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行容器 设置网络、端口映射、容器内存、esJVM内存")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" es01 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--net")]),a._v(" elastic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9200")]),a._v(":9200 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9300")]),a._v(":9300 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" 4GB "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ES_JAVA_OPTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-Xms2g -Xmx2g"')]),a._v(" docker.elastic.co/elasticsearch/elasticsearch:8.15.3\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行结束后会打印信息，需要进行记录。后续使用！！如下图")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 容器启动成功后，浏览器进行访问，（注意：必须使用https）")]),a._v("\nhttps://容器所在机器的IP:9200/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输入之前打印信息中的用户名密码即可登录成功")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106145635296.png",alt:"image-20241106145635296"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106145911492.png",alt:"image-20241106145911492"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106145924964.png",alt:"image-20241106145924964"}})]),a._v(" "),s("h3",{attrs:{id:"_3、安装kibana-8-15-3-单机部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装kibana-8-15-3-单机部署"}},[a._v("#")]),a._v(" 3、安装Kibana:8.15.3（单机部署）")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载Kibana镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull docker.elastic.co/kibana/kibana:8.15.3\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行容器，使用之前创建的elastic网络")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" kib01 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--net")]),a._v(" elastic "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5601")]),a._v(":5601 docker.elastic.co/kibana/kibana:8.15.3\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 持续监控Kibana日志")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" kib01\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 直到出现i Kibana has not been configured.字样，说明安装成功，浏览器访问Kibana")]),a._v("\nhttp://192.168.10.101:5601/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 出现配置页面，需要输入最开始ES安装结束输出的信息，Kibana的token")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#输入token之后，点击配置，会提示输入确认码，这个确认嘛会打印在刚才监控的Kibana日志中（如图）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输入确认码，之后等待配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置完成会进入登录页面，输入ES的登录名和密码即可登录成功")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106150454461.png",alt:"image-20241106150454461"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106150556129.png",alt:"image-20241106150556129"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106150712060.png",alt:"image-20241106150712060"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20241106150745604.png",alt:"image-20241106150745604"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);