<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CHAR与VARCHAR的区别 | 赵宇博的技术博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="沉淀，静待花开">
    
    <link rel="preload" href="/assets/css/0.styles.42a2c9ab.css" as="style"><link rel="preload" href="/assets/js/app.1ab1c558.js" as="script"><link rel="preload" href="/assets/js/2.1e4db32b.js" as="script"><link rel="preload" href="/assets/js/55.5e7a6b2c.js" as="script"><link rel="prefetch" href="/assets/js/10.aeedf8b7.js"><link rel="prefetch" href="/assets/js/11.511c0a34.js"><link rel="prefetch" href="/assets/js/12.9b58b774.js"><link rel="prefetch" href="/assets/js/13.cb7bbd88.js"><link rel="prefetch" href="/assets/js/14.98182ddd.js"><link rel="prefetch" href="/assets/js/15.a5339ac4.js"><link rel="prefetch" href="/assets/js/16.800209f1.js"><link rel="prefetch" href="/assets/js/17.ce529c5c.js"><link rel="prefetch" href="/assets/js/18.673249a6.js"><link rel="prefetch" href="/assets/js/19.2cc40000.js"><link rel="prefetch" href="/assets/js/20.ec07d201.js"><link rel="prefetch" href="/assets/js/21.49151248.js"><link rel="prefetch" href="/assets/js/22.a5853ae9.js"><link rel="prefetch" href="/assets/js/23.2f53cb8d.js"><link rel="prefetch" href="/assets/js/24.25222c19.js"><link rel="prefetch" href="/assets/js/25.c6e546e3.js"><link rel="prefetch" href="/assets/js/26.20f05943.js"><link rel="prefetch" href="/assets/js/27.4e989696.js"><link rel="prefetch" href="/assets/js/28.01ca5fcb.js"><link rel="prefetch" href="/assets/js/29.c6ca9ffc.js"><link rel="prefetch" href="/assets/js/3.f4e28723.js"><link rel="prefetch" href="/assets/js/30.5bbe2551.js"><link rel="prefetch" href="/assets/js/31.57ab7c88.js"><link rel="prefetch" href="/assets/js/32.496dd62f.js"><link rel="prefetch" href="/assets/js/33.0d42dfa0.js"><link rel="prefetch" href="/assets/js/34.c26055a1.js"><link rel="prefetch" href="/assets/js/35.87428ea5.js"><link rel="prefetch" href="/assets/js/36.d61d6964.js"><link rel="prefetch" href="/assets/js/37.4fc0770e.js"><link rel="prefetch" href="/assets/js/38.ba7dbc6d.js"><link rel="prefetch" href="/assets/js/39.131015e3.js"><link rel="prefetch" href="/assets/js/4.beb55bf3.js"><link rel="prefetch" href="/assets/js/40.a3cbe702.js"><link rel="prefetch" href="/assets/js/41.6b0efe9d.js"><link rel="prefetch" href="/assets/js/42.6f1c7b28.js"><link rel="prefetch" href="/assets/js/43.5fe35069.js"><link rel="prefetch" href="/assets/js/44.68437956.js"><link rel="prefetch" href="/assets/js/45.37a1e6d3.js"><link rel="prefetch" href="/assets/js/46.b254992b.js"><link rel="prefetch" href="/assets/js/47.700e31eb.js"><link rel="prefetch" href="/assets/js/48.ed278cea.js"><link rel="prefetch" href="/assets/js/49.8294380e.js"><link rel="prefetch" href="/assets/js/5.d78e4b01.js"><link rel="prefetch" href="/assets/js/50.14f8b26c.js"><link rel="prefetch" href="/assets/js/51.fb250606.js"><link rel="prefetch" href="/assets/js/52.3830165c.js"><link rel="prefetch" href="/assets/js/53.593a0324.js"><link rel="prefetch" href="/assets/js/54.32068f44.js"><link rel="prefetch" href="/assets/js/56.faa7bec0.js"><link rel="prefetch" href="/assets/js/57.43fd4c01.js"><link rel="prefetch" href="/assets/js/58.266c1344.js"><link rel="prefetch" href="/assets/js/59.1f22adde.js"><link rel="prefetch" href="/assets/js/6.ccd58986.js"><link rel="prefetch" href="/assets/js/60.18cd167a.js"><link rel="prefetch" href="/assets/js/61.40258fc6.js"><link rel="prefetch" href="/assets/js/7.124e7d84.js"><link rel="prefetch" href="/assets/js/8.10170a8b.js"><link rel="prefetch" href="/assets/js/9.e8097390.js">
    <link rel="stylesheet" href="/assets/css/0.styles.42a2c9ab.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="赵宇博的技术博客" class="logo"> <span class="site-name can-hide">赵宇博的技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/fe/" class="nav-link">前端</a></div><div class="nav-item"><a href="/be/" class="nav-link">后端</a></div><div class="nav-item"><a href="/data/" class="nav-link router-link-active">数据库专栏</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">k8s专栏</a></div><div class="nav-item"><a href="/dcs/" class="nav-link">分布式专栏</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux网络专栏</a></div><div class="nav-item"><a href="/self/" class="nav-link">手写系列专栏</a></div><div class="nav-item"><a href="/more/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/zhaoyb-coder" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/fe/" class="nav-link">前端</a></div><div class="nav-item"><a href="/be/" class="nav-link">后端</a></div><div class="nav-item"><a href="/data/" class="nav-link router-link-active">数据库专栏</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">k8s专栏</a></div><div class="nav-item"><a href="/dcs/" class="nav-link">分布式专栏</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux网络专栏</a></div><div class="nav-item"><a href="/self/" class="nav-link">手写系列专栏</a></div><div class="nav-item"><a href="/more/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/zhaoyb-coder" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Mysql总结</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/data/931102/" class="sidebar-link">Mysql锁-技术分析</a></li><li><a href="/data/2f28ce/" class="sidebar-link">Mysql-日志详解</a></li><li><a href="/data/23422/" aria-current="page" class="active sidebar-link">CHAR与VARCHAR的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/data/23422/#_1、char与varchar的区别" class="sidebar-link">1、CHAR与VARCHAR的区别</a></li><li class="sidebar-sub-header level2"><a href="/data/23422/#_2、varchar-m-能设置的最大长度" class="sidebar-link">2、VARCHAR(M) 能设置的最大长度</a></li><li class="sidebar-sub-header level2"><a href="/data/23422/#_3、varchar的空间使用情况" class="sidebar-link">3、VARCHAR的空间使用情况</a></li><li class="sidebar-sub-header level2"><a href="/data/23422/#_4、varchar-50-和-varchar-500-的区别" class="sidebar-link">4、VARCHAR(50) 和 VARCHAR(500) 的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/data/23422/#_4-1、索引有最大长度的限制" class="sidebar-link">4.1、索引有最大长度的限制</a></li><li class="sidebar-sub-header level3"><a href="/data/23422/#_4-2、memory引擎的限制" class="sidebar-link">4.2、MEMORY引擎的限制</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/data/23422/#_5、总结" class="sidebar-link">5、总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES总结</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/data/#数据库专栏" data-v-06225672>数据库专栏</a></li><li data-v-06225672><a href="/data/#Mysql总结" data-v-06225672>Mysql总结</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/zhaoyb-coder" target="_blank" title="作者" class="beLink" data-v-06225672>zhaoyb</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-08-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">CHAR与VARCHAR的区别<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="char与varchar的区别"><a href="#char与varchar的区别" class="header-anchor">#</a> CHAR与VARCHAR的区别</h1> <p>在使用MySQL的过程中，在存储字符串时，大家或许都有过这样或那样的困惑，譬如：</p> <ul><li>对于固定长度的字符串，为什么推荐使用 CHAR 来存储？</li> <li>VARCHAR 可设置的最大长度是多少？</li> <li>给定一个字符串，怎么知道它的空间使用情况？</li> <li>创建索引时，提示“Index column size too large. The maximum column size is 767 bytes”，该如何解决？</li> <li>VARCHAR 为何要按需设置？VARCHAR(50) 和 VARCHAR(500) 有什么区别？</li></ul> <p>下面就这些问题做一个系统的分析。</p> <h2 id="_1、char与varchar的区别"><a href="#_1、char与varchar的区别" class="header-anchor">#</a> 1、CHAR与VARCHAR的区别</h2> <p>两者都可用来存储字符串。只不过 CHAR 常用来存储固定长度的字符串，VARCHAR 常用来存储可变长度的字符串。为什么要这样区分呢？</p> <p>首先看下面这个表格。在latin1字符集中，CHAR(4) 和 VARCHAR(4) 的存储对比。</p> <table><thead><tr><th>值</th> <th>CHAR(4)</th> <th>存储需求（字节）</th> <th>VARCHAR(4)\</th> <th>存储需求（字节）</th></tr></thead> <tbody><tr><td>''</td> <td>' '</td> <td>4</td> <td>''</td> <td>1</td></tr> <tr><td>'ab'</td> <td>'ab '</td> <td>4</td> <td>'ab'</td> <td>3</td></tr> <tr><td>'abcd'</td> <td>'abcd'</td> <td>4</td> <td>'abcd'</td> <td>5</td></tr> <tr><td>'abcdefgh'</td> <td>'abcd'</td> <td>4</td> <td>'abcd'</td> <td>5</td></tr></tbody></table> <p>基于表格的内容，我们可以得出以下结论：</p> <p>对于 CHAR(4) ，</p> <p>无论插入什么值，存储需求都是不变的，固定4个字节。</p> <p>在实际存储的时候，对于不足4字节的值，右边会以空格填充。</p> <p>对于 VARCHAR(4) ，</p> <p>存储的需求与插入的值有关。</p> <p>存储的需求 = 字符串所占的字节数 + 1。为什么要加1呢？这个与 VARCHAR 的实现有关，为了实现“按需分配”的目的，它需要额外的字节来表示字符串的长度。</p> <p>所以，对于固定长度的字符串推荐使用 CHAR 来存储，相对于 VARCHAR ，前者会少用一个字节。</p> <p>另外，'abcdefgh'被截断为'abcd'进行存储，是在 SQL_MODE 非严格模式下。如果是在SQL_MODE严格模式（SQL_MODE中开启了STRICT_ALL_TABLES或STRICT_TRANS_TABLES）下，会直接报错。</p> <h2 id="_2、varchar-m-能设置的最大长度"><a href="#_2、varchar-m-能设置的最大长度" class="header-anchor">#</a> 2、VARCHAR(M) 能设置的最大长度</h2> <p>M 限制了 VARCHAR 能存储的字符串的最大长度，****注意，是字符，不是字节****，其有效值范围为 0 ~ 65535。虽然可设置的范围是 0 ～ 65535，但 M 真的就能设置为65535 吗？</p> <p>看下面这个测试。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65535</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">row</span> size <span class="token keyword">for</span> the used <span class="token keyword">table</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token operator">not</span> counting BLOBs<span class="token punctuation">,</span> <span class="token operator">is</span> <span class="token number">65535.</span> This includes storage overhead<span class="token punctuation">,</span> <span class="token keyword">check</span> the manual<span class="token punctuation">.</span> You have <span class="token keyword">to</span> change <span class="token keyword">some</span> <span class="token keyword">columns</span> <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> BLOBs



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65534</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">row</span> size <span class="token keyword">for</span> the used <span class="token keyword">table</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token operator">not</span> counting BLOBs<span class="token punctuation">,</span> <span class="token operator">is</span> <span class="token number">65535.</span> This includes storage overhead<span class="token punctuation">,</span> <span class="token keyword">check</span> the manual<span class="token punctuation">.</span> You have <span class="token keyword">to</span> change <span class="token keyword">some</span> <span class="token keyword">columns</span> <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> BLOBs



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65533</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">row</span> size <span class="token keyword">for</span> the used <span class="token keyword">table</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token operator">not</span> counting BLOBs<span class="token punctuation">,</span> <span class="token operator">is</span> <span class="token number">65535.</span> This includes storage overhead<span class="token punctuation">,</span> <span class="token keyword">check</span> the manual<span class="token punctuation">.</span> You have <span class="token keyword">to</span> change <span class="token keyword">some</span> <span class="token keyword">columns</span> <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> BLOBs



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65532</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>由此来看，在 latin1 字符集下，M 最大就只能设置为 65532。</p> <p>其实不然，再看下面这个示例。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65533</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65534</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">row</span> size <span class="token keyword">for</span> the used <span class="token keyword">table</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token operator">not</span> counting BLOBs<span class="token punctuation">,</span> <span class="token operator">is</span> <span class="token number">65535.</span> This includes storage overhead<span class="token punctuation">,</span> <span class="token keyword">check</span> the manual<span class="token punctuation">.</span> You have <span class="token keyword">to</span> change <span class="token keyword">some</span> <span class="token keyword">columns</span> <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> BLOBs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果将列定义为NOT NULL，M 最大可设置为 65533。</p> <p>上面演示的是latin1下的使用场景，如果是其它字符集呢？</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65533</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> utf8mb4<span class="token punctuation">;</span>

ERROR <span class="token number">1074</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Column</span> length too big <span class="token keyword">for</span> <span class="token keyword">column</span> <span class="token string">'c1'</span> <span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">16383</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">use</span> <span class="token keyword">BLOB</span> <span class="token operator">or</span> <span class="token keyword">TEXT</span> instead



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65533</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> utf8<span class="token punctuation">;</span>

ERROR <span class="token number">1074</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Column</span> length too big <span class="token keyword">for</span> <span class="token keyword">column</span> <span class="token string">'c1'</span> <span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">21845</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">use</span> <span class="token keyword">BLOB</span> <span class="token operator">or</span> <span class="token keyword">TEXT</span> instead
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>基于报错信息，可以看出，对于utf8mb4字符集，M最大只能设置为16383。对于utf8字符集，M最大只能设置为21845。这两个数值是怎么计算出来的呢？</p> <p>在utf8mb4字符集中，最多需要4个字节来表示一个字符，所以 65535 / 4 = 16383 。而在utf8字符集中，最多需要3个字节来表示一个字符，所以 65535 / 3 = 21845。</p> <p>由此来看，在设置 M 的大小时，起决定作用的并不是 M 的有效值范围（0 ~ 65535），而是 M * 字符集的最大字节数不能超过65535个字节。</p> <p>为什么不能超过 65535 字节呢？</p> <p><em><strong>因为MySQL限制了一条记录的最大长度就是65535字节</strong></em></p> <p>除此之外，对于VARCHAR，在实际设置时，还需考虑以下两个因素：</p> <p>MySQL需要1 ～ 2个字节来表示字符串的长度。具体来说，如果字符串占用的字节数在 0 ～255 之间，需1个字节来表示，如果大于 255 个字节，则需2个字节来表示。</p> <p>如果列定义为NULL，额外还需要1个字节。</p> <p>既然 65535 是记录的最大长度，则这个限制不仅仅是针对一列，而是所有列。即所有列的长度加起来不能超过65535。</p> <p>看下面这个示例，指定了2个列，分别定义为VARCHAR和INT。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65530</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>c2 <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">row</span> size <span class="token keyword">for</span> the used <span class="token keyword">table</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token operator">not</span> counting BLOBs<span class="token punctuation">,</span> <span class="token operator">is</span> <span class="token number">65535.</span> This includes storage overhead<span class="token punctuation">,</span> <span class="token keyword">check</span> the manual<span class="token punctuation">.</span> You have <span class="token keyword">to</span> change <span class="token keyword">some</span> <span class="token keyword">columns</span> <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> BLOBs



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65529</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>c2 <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.10</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>因为INT会占4个字节，所以 c1 最大就只能设置为65535 - 4 - 2 = 65529。这里之所以要减去2，是因为varchar(65529)超过了255个字节，需要2个字节来表示其长度。</p> <p>报错信息中，提到“The maximum row size for the used table type, not counting BLOBs, is 65535”，即记录的最大长度限制不包括BLOB等字段。</p> <p>之所以将BLOB和TEXT排除在外，是因为它的内容会单独存储在其它页中。但即便如此，存储BLOB和TEXT的指针信息也需要9 ~ 12个字节，具体来说：</p> <p>TINYTEXT(TINYBLOB): 9 字节</p> <p>TEXT(BLOB): 10 字节</p> <p>MEDIUMTEXT(MEDIUMBLOB): 11字节</p> <p>LONGTEXT(LONGBLOB): 12字节。</p> <p>看下面这个示例，指定了2个列，分别定义为VARCHAR和TEXT</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65524</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>c2 <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">row</span> size <span class="token keyword">for</span> the used <span class="token keyword">table</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token operator">not</span> counting BLOBs<span class="token punctuation">,</span> <span class="token operator">is</span> <span class="token number">65535.</span> This includes storage overhead<span class="token punctuation">,</span> <span class="token keyword">check</span> the manual<span class="token punctuation">.</span> You have <span class="token keyword">to</span> change somecolumns <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> BLOBs



mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65523</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>c2 <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.13</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>因为TEXT占了10个字节，所以 c1 最大可设置为65535 - 10 - 2 = 65523。</p> <p>注意，上面提到的一条记录的最大长度不能超过65535字节是MySQL的限制，与存储引擎无关。实际上，存储引擎对行长也有限制。在InnoDB存储引擎中，就规定一条记录的最大长度不能超过数据页大小的1/2。</p> <p>InnoDB中数据页的大小由innodb_page_size参数决定，默认为16K。所以，在页长为16K的情况下，InnoDB中一条记录的大小不能超过8K。如果超过了8K，InnoDB会将部分变长字段存储在外部页中。</p> <p>看下面这个示例，因为定义的都是CHAR，定长字段，所以不会存储在外部页中</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t <span class="token punctuation">(</span>

​       c1 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c2 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c3 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c4 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c5 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c6 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c7 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c8 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c9 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c10 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c11 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c12 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c13 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c14 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c15 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c16 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c17 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c18 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c19 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c20 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c21 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c22 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c23 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c24 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c25 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c26 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c27 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c28 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c29 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c30 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

​       c31 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c32 <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>

​       <span class="token punctuation">)</span> <span class="token keyword">charset</span> latin1<span class="token punctuation">;</span>

ERROR <span class="token number">1118</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">Row</span> size too large <span class="token punctuation">(</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">8126</span><span class="token punctuation">)</span><span class="token punctuation">.</span> Changing <span class="token keyword">some</span> <span class="token keyword">columns</span> <span class="token keyword">to</span> <span class="token keyword">TEXT</span> <span class="token operator">or</span> <span class="token keyword">BLOB</span> may help<span class="token punctuation">.</span> <span class="token operator">In</span> <span class="token keyword">current</span> <span class="token keyword">row</span> format<span class="token punctuation">,</span> <span class="token keyword">BLOB</span> prefix <span class="token keyword">of</span> <span class="token number">0</span> bytes <span class="token operator">is</span> stored inline<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_3、varchar的空间使用情况"><a href="#_3、varchar的空间使用情况" class="header-anchor">#</a> 3、VARCHAR的空间使用情况</h2> <p>给定一个VARCHAR类型的字符串，怎么知道它的空间使用情况呢？</p> <p>首先，看看官方文档的说法。</p> <table><thead><tr><th>类型</th> <th>存储需求</th></tr></thead> <tbody><tr><td>VARCHAR(M)</td> <td>L + 1 bytes if column values require 0 − 255 bytes, L + 2 bytes if values may require more than 255 bytes</td></tr></tbody></table> <p>这里的 L 指的是字符串所占的字节数，与字符集有关。</p> <p>以“中国”为例。</p> <p>在utf8mb4中，一个中文汉字需要 3 个字节来表示，所以，“中国”通过utf8mb4来存储，会占用6个字节。</p> <p>而在GBK，一个中文汉字只需2个字节来表示，所以，“中国”通过GBK来存储，会占用4个字节。</p> <p>除此之外，还需要额外的1~2个字节来表示字符串的长度。</p> <h2 id="_4、varchar-50-和-varchar-500-的区别"><a href="#_4、varchar-50-和-varchar-500-的区别" class="header-anchor">#</a> 4、VARCHAR(50) 和 VARCHAR(500) 的区别</h2> <p>很多人可能会好奇，VARCHAR 不是按需分配的么？在满足业务的需求情况下，设置 VARCHAR(50) 和 VARCHAR(500) 有什么区别呢？最后的空间占用还不是以实际写入的字符串为主，从这个角度来看，确实没错。但考虑以下两点：</p> <h3 id="_4-1、索引有最大长度的限制"><a href="#_4-1、索引有最大长度的限制" class="header-anchor">#</a> 4.1、索引有最大长度的限制</h3> <p>对于行格式为 REDUNDANT 或 COMPACT 的InnoDB表，索引的最大长度被限制为767字节。所以，在MySQL 5.6 中，在创建索引时，我们通常会碰到“Index column size too large. The maximum column size is 767 bytes”错误：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t<span class="token punctuation">(</span>c1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>  

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>



mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">add</span> <span class="token keyword">index</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>

ERROR <span class="token number">1709</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: <span class="token keyword">Index</span> <span class="token keyword">column</span> size too large<span class="token punctuation">.</span> The maximum <span class="token keyword">column</span> size <span class="token operator">is</span> <span class="token number">767</span> bytes<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上面这个限制不仅仅适用于单个索引，同样也适用于复合索引。</p> <p>要解决这个问题，可选的方案有：</p> <p>减少字段的长度，确保字段的长度 * 字符集的最大字节数不超过767。</p> <p>设置前缀索引，确保前缀索引的长度 * 字符集的最大字节数不超过767。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">add</span> <span class="token keyword">index</span><span class="token punctuation">(</span>c1<span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

Records: <span class="token number">0</span> Duplicates: <span class="token number">0</span> <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将表的行格式设置为 DYNAMIC 或 COMPRESSED，同时开启innodb_large_prefix，索引的最大长度可支持3072字节。</p> <p>在 MySQL 5.6 中，如果要将表的行格式设置为DYNAMIC 或 COMPRESSED，必须将参数innodb_file_format设置为Barracuda。</p> <p>innodb_file_format用来设置InnoDB文件的格式，支持的文件格式有Antelope和Barracuda。Antelope是最早的文件格式，支持REDUNDANT和COMPACT这两种行格式，而Barracuda则是最新的文件格式，支持DYNAMIC和COMPRESSED这两种行格式。</p> <p>在 MySQL 5.6 中，innodb_file_format默认为Antelope，创建表时，如果没有显式指定row_format，则默认为Compact。</p> <p>在 MySQL 5.7 中，innodb_file_format默认为Barracuda，创建表时，如果没有显式指定row_format，则默认为Dynamic。</p> <p>在 MySQL 8.0 中，innodb_file_format被移除了，取而代之的是innodb_default_row_format。该参数用来设置默认的row_format，默认值为dynamic。</p> <p>而innodb_large_prefix呢？在 MySQL 5.6 中，默认为OFF。 在 MySQL 5.7 中，默认为ON，在 MySQL 8.0中，也移除了。</p> <p>这也是为什么在 MySQL 5.6 中，更容易出现“Index column size too large. The maximum column size is 767 bytes”错误。</p> <h3 id="_4-2、memory引擎的限制"><a href="#_4-2、memory引擎的限制" class="header-anchor">#</a> 4.2、MEMORY引擎的限制</h3> <p>在 MySQL 8.0 之前，内存临时表只支持 MEMORY 引擎，而 MEMORY 引擎会将 VARCHAR 等变长类型作为定长来分配内存。</p> <p>When in-memory internal temporary tables are managed by the MEMORY storage engine, fixed-length row format is used. VARCHAR and VARBINARY column values are padded to the maximum column length, in effect storing them as CHAR and BINARY columns.</p> <p>可喜的是，从 MySQL 8.0 开始，内存临时表支持 TempTable 引擎。TempTable 引擎，从 MySQL 8.0.13 开始，优化了VARCHAR等变长类型的存储。</p> <h2 id="_5、总结"><a href="#_5、总结" class="header-anchor">#</a> 5、总结</h2> <p>1、对于固定长度的字符串推荐使用 CHAR 来存储。</p> <p>2、VARCHAR能设置的最大长度与使用的字符集、自身占用的字节数、是否定义为NULL有关。</p> <p>3、MySQL限制了一条记录的最大长度是 65535 字节。</p> <p>4、InnoDB存储引擎限制了一条记录的最大长度不能超过数据页大小的1/2。但在实际处理的时候，InnoDB会将部分变长字段存储在外部页中，所以我们实际能存储的比限制的要大。</p> <p>5、字符串所占的字节数，与字符集有关。除此之外，还需要额外的1~2个字节来表示字符串的长度。</p> <p>6、在满足业务需求的情况下，VARCHAR应越短越好。</p> <p>7、对于行格式为 REDUNDANT 或 COMPACT 的InnoDB表，索引的最大长度为767字节。</p> <p>8、对于行格式为 DYNAMIC 或 COMPRESSED 的InnoDB表，索引的最大长度为3072字节。</p> <p>9、MEMORY 引擎会将 VARCHAR 等变长类型作为定长来分配内存。</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=VARCHAR" title="标签">#VARCHAR</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/08/08, 15:42:24</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/data/2f28ce/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Mysql-日志详解</div></a> <a href="/data/932202/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Redis-概述</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/data/2f28ce/" class="prev">Mysql-日志详解</a></span> <span class="next"><a href="/data/932202/">Redis-概述</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/data/89085675/"><div>
            Docker安装ELK8.x（踩坑记录）
            <!----></div></a> <span class="date">11-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/be/92765/"><div>
            多线程场景解决方案汇总
            <!----></div></a> <span class="date">10-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/k8s/docker/100002/"><div>
            Cgroup
            <!----></div></a> <span class="date">10-22</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2024
    <span>赵宇博 | <a href="https://github.com/zhaoyb-coder/" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1ab1c558.js" defer></script><script src="/assets/js/2.1e4db32b.js" defer></script><script src="/assets/js/55.5e7a6b2c.js" defer></script>
  </body>
</html>
